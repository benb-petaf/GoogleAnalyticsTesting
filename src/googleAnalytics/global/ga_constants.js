////////////////////////////
//         Apps
////////////////////////////

//---- App Values ----
var petaGA_AppCategory = "App";
var petaGA_AppAction_Installed = "Installed";

////////////////////////////
//         Audio
////////////////////////////

//---- Audio Category Values ----
var petaGA_AudioCategory_Audio = "Audio";

////////////////////////////
//         E-Cards
////////////////////////////

//---- E-Card Category Values ----
var petaGA_eCardCategory_eCard = "E-Card";

////////////////////////////
//         Forms
////////////////////////////

//---- Form Category Values ----
var petaGA_FormCategory_Activist = "Activist Form";
var petaGA_FormCategory_Comment = "Comment Form";
var petaGA_FormCategory_Contest = "Contest Form";
var petaGA_FormCategory_DataCollect = "Data Collect Form";
var petaGA_FormCategory_Donate = "Donation Form";
var petaGA_FormCategory_eCard = "E-Card Form";
var petaGA_FormCategory_eNews = "E-News Form";
var petaGA_FormCategory_Feedback = "Feedback Form";
var petaGA_FormCategory_ForwardToAFriend = "Forward to a Friend Form";
var petaGA_FormCategory_LegislatorLookup = "Legislator Lookup Form";
var petaGA_FormCategory_Login = "Login Form";
var petaGA_FormCategory_Mobile = "Mobile Form";
var petaGA_FormCategory_NewsletterSubscription = "Newsletter Subscription";
var petaGA_FormCategory_Pack = "Pack Form";
var petaGA_FormCategory_Petition = "Petition Form";
var petaGA_FormCategory_Pledge = "Pledge Form";
var petaGA_FormCategory_Poll = "Poll Form";
var petaGA_FormCategory_Purchase = "Purchase Form";
var petaGA_FormCategory_Quiz = "Quiz Form";
var petaGA_FormCategory_Registration = "Registration Form";
var petaGA_FormCategory_Submission = "Submission Form";
var petaGA_FormCategory_TakeAction = "Take Action Form";
var petaGA_FormCategory_Volunteer = "Volunteer Form";
// On Reflection, this is so wildly soecific to Phone2Action that it should be on those files, not in the generic section
//var petaGA_FormCategory_WhoDoYouKnow = "Who Do You Know Form";
var petaGA_FormCategory_Wishlist = "Wishlist Form";

//---- Form Action Values ----
var petaGA_FormAction_Initiated = "Form Initiated";
var petaGA_FormAction_Submitted = "Form Submitted";

////////////////////////////
//         Games
////////////////////////////

//---- Game Category Values ----
var petaGA_GameCategory_Game = "Game";

////////////////////////////
//    Generic Categories
////////////////////////////
var petaGA_GenericCategory_TweetToTarget = "Tweet to Target";
var petaGA_GenericCategory_ClickToCall = "Click to Call";


////////////////////////////
//    Generic Actions
////////////////////////////

//---- Generic Action Values ----
var petaGA_GenericAction_Clicked = "Clicked";
var petaGA_GenericAction_ClickThrough = "Click Through";
var petaGA_GenericAction_Closed = "Closed";
var petaGA_GenericAction_Complete = "Complete";
var petaGA_GenericAction_Download = "Download";
var petaGA_GenericAction_End = "End";
var petaGA_GenericAction_Play = "Play";
var petaGA_GenericAction_Pause = "Pause";

var petaGA_GenericAction_Receipt = "Receipt/Pick-Up";
var petaGA_GenericAction_Share = "Share";
var petaGA_GenericAction_Viewed = "Viewed";
var petaGA_GenericAction_LanguageSwitch = "Switch Language";
var petaGA_GenericAction_Saved = "Post Saved";
var petaGA_GenericAction_Unsaved = "Post Unsaved";

//Don't use petaGA_DownloadAction_Downloaded, but leave it in this file.
var petaGA_DownloadAction_Downloaded = "Download";

////////////////////////////
//         Images
////////////////////////////

//---- Image Category Values ----
var petaGA_ImageCategory_Image = "Image";

////////////////////////////
//      Interactive
////////////////////////////

//---- Interactive Category Values ----
var petaGA_InteractiveCategory_Interactive = "Interactive";

//---- Interactive Action Values ----
var petaGA_InteractiveAction_Scrolled = "Scrolled";
var petaGA_InteractiveAction_ReadMore = "Read More";
var petaGA_InteractiveAction_ReadLess = "Read Less";

// Scroll Depth Tracking //
var petaGA_Category_Scroll_Depth = "Scroll Depth";
var petaGA_Action_Scroll_Depth_25 = "25%";
var petaGA_Action_Scroll_Depth_50 = "50%";
var petaGA_Action_Scroll_Depth_75 = "75%";


////////////////////////////
//      Subscriptions
////////////////////////////

//---- Subscription Category Values ----
var petaGA_SubscriptionCategory_Newsletter = "Newsletter Subscription";

//---- Interactive Action Values ----
var petaGA_SubscriptionAction_Submitted = "Form Submitted";
var petaGA_SubscriptionAction_OptIn = "Opt-In Confirmation";


////////////////////////////
//      User Interface
////////////////////////////

//---- UI Category Values ----
var petaGA_UICategory_Button = "Button";
var petaGA_UICategory_Menu = "Menu";
var petaGA_UICategory_Accordion = "Accordion";
var petaGA_UICategory_About = "About";
var petaGA_UICategory_List = "List";
var petaGA_UICategory_Menu = "Menu";
var petaGA_UICategory_Related_Articles = "Related Articles";
var petaGA_UICategory_Tags_Keywords = "Tags Keywords";
var petaGA_UICategory_Teaser = "Teaser";
var petaGA_UICategory_Home_Tile = "Tile";
var petaGA_UICategory_addthis = "addthis";
var petaGA_UICategory_Carousel = "Carousel";

////////////////////////////
//         Links
////////////////////////////

//---- Link Category Values ----
var petaGA_LinkCategory_Link = "Link";
//Don't use petaGA_LinkCategory_Subscribe, but leave it in this file.
var petaGA_LinkCategory_Subscribe = "Link";

////////////////////////////
//         PDFs
////////////////////////////

//---- PDF Category Values ----
var petaGA_PDFCategory_PDF = "PDF";
//Don't use petaGA_DownloadCategory_PDF, but leave it in this file.
var petaGA_DownloadCategory_PDF = "PDF";

////////////////////////////
//         Slideshows
////////////////////////////

//---- Slideshow Category Values ----
var petaGA_SlideshowCategory_Slideshow = "Slideshow";

//---- Slideshow Action Values ----
var petaGA_SlideshowAction_Auto = "Slideshow Auto-play";
var petaGA_SlideshowAction_Backward = "Slideshow Backward";
var petaGA_SlideshowAction_Forward = "Slideshow Forward";

////////////////////////////
//    Social Networking
////////////////////////////

/******************************************
These should only be used for 
social networking buttons that we created, 
NOT for AddThis/API buttons.
*****************************************/

//---- Social Networking Source Values ----
var petaGA_SNsource_Facebook = "Facebook";
var petaGA_SNsource_Twitter = "Twitter";
var petaGA_SNsource_Digg = "Digg";
var petaGA_SNsource_StumbleUpon = "StumbleUpon";
var petaGA_SNsource_Reddit = "Reddit";
var petaGA_SNsource_Tumblr = "Tumblr";
var petaGA_SNsource_GooglePlus = "Google+";
var petaGA_SNsource_Pinterest = "Pinterest";
var petaGA_SNsource_WhatsApp = "WhatsApp";
var petaGA_SNsource_email = "email";
var petaGA_SNsource_pinterest_share = "pinterest share";
var petaGA_SNsource_linkedin = "linkedin";

//---- Social Networking Action Values ----
//Use petaGA_GenericAction_Share

////////////////////////////
//    Splash Pages
////////////////////////////

var petaGA_SplashCategory = "Splash Page";

////////////////////////////
//  User Generated Content
////////////////////////////

//---- User Generated Content Category Values ----
var petaGA_UserGeneratedContentCategory = "User Generated Content";

//---- User Generated Content Action Values ----
//No actions yet.

////////////////////////////
//         Videos
////////////////////////////

//---- Video Category Values ----
var petaGA_VideoCategory_Video = "Video";

////////////////////////////
//         Beauty Without Bunnies / Cruelty Free Company Search /  Shop Cruelty Free
////////////////////////////

var petaGA_BWBCategory_Search = "Cruelty Free Company Search";

var petaGA_BWBSearchAction_Keyword = "Keyword Search";
var petaGA_BWBSearchAction_DoesNotTest = "Does Not Test";
var petaGA_BWBSearchAction_ProductType = "Product Type";
var petaGA_BWBSearchAction_Country = "Country";
var petaGA_BWBSearchAction_DoesTest = "Does Test";
var petaGA_BWBSearchAction_RegulatoryChange = "Regulatory Change";
var petaGA_BWBSearchAction_DisplayFilter = "Display Filter";
var petaGA_BWBSearchAction_AvailabilityFilter = "Availability Filter";
var petaGA_BWBSearchAction_ResultsPerPage = "Results Per Page";
var petaGA_BWBSearchAction_PageTransition = "Page Transition";

////////////////////////////
//  PETA Germany Custom Events
////////////////////////////
var petaGA_DECategory_Veganstart_Subscription = "Veganstart Subscription";

var petaGA_DECategory_Lifestyle_Tile = "LifestyleTile";
var petaGA_DECategory_Lifestyle = "Lifestyle";

var petaGA_DEAction_Petition_Form_Twitter = "SM Twitter";
var petaGA_DEAction_Petition_Form_Facebook = "SM Facebook";
var petaGA_DEAction_Petition_Form_WhatsApp = "SM WhatsApp";

////////////////////////////
//  File Extensions Array
////////////////////////////

var petaGA_fileExtensions = new Array(".pdf",
									  ".doc",
									  ".docx",
									  ".png",
									  ".jpg",
									  ".jpeg");

////////////////////////////
//  Linked Domains Array
////////////////////////////			

var petaGA_linkedDomains = new Array("81fur.com",
									 "allaboutanimals.org.uk",
									 "animalrahat.com",
									 "avianflu.cn",
									 "avianflu.hk",
									 "avianflu.in.th",
									 "bloodyburberry.com",
									 "bwvaktboom.com",
									 "canadasshame.com",
									 "chuaychangthai.com",
									 "columbiacruelty.com",
									 "compassionatecitizen.org",
									 "consumerdeception.com",
									 "covancecruelty.com",
									 "dkbunnybutcher.com",
									 "doanglershavesmallrods.com",
									 "helpthaielephants.com",
									 "iamscruelty.com",
									 "ingridnewkirk.com",
									 "islamicconcerns.com",
									 "jesusveg.com",
									 "kentuckyfriedcruelty.com",
									 "lettuceladies.com",
									 "marscandykills.com",
									 "mccruelty.com",
									 "meat.org",
									 "milkgonewild.com",
									 "namethatdriver.com",
									 "nesteacrueltea.com",
									 "nofur.hk",
									 "peta.nl",
									 "/(peta\.org)/",
									 "peta.org.au",
									 "peta.org.uk",
									 "peta.xxx",
									 "peta2.com",
									 "petaasiapacific.com",
									 "petacatalog.com",
									 "petaf.org.uk",
									 "petafoundation.org",
									 "petafrance.com",
									 "petaindia.com",
									 "petakids.com",
									 "petalatino.com",
									 "petamall.com",
									 "petatv.com",
									 "petavanguardsociety.com",
									 "petsmartcruelty.com",
									 "ringlingbeatsanimals.com",
									 "runningofthenudes.com",
									 "sharetheworld.org.uk",
									 "teachkind.org",
									 "unbearablecruelty.com",
									 "vegadvantage.com",
                                     "wickedwildlifefund.com",
                                     "shouldieatcheese.com");

/* Polyfill for String.includes() from https://mzl.la/2yNPCGg that fixes this function breaking IE where it's missing */
if (!String.prototype.includes) {
	String.prototype.includes = function(search, start) {
		'use strict';
		if (typeof start !== 'number') {
			start = 0;
		}

		if (start + search.length > this.length) {
			return false;
		} else {
			return this.indexOf(search, start) !== -1;
		}
	};
}

function lookForFileExtension(url) {
    var currentFileExtension;
    for (var i = 0; i < petaGA_fileExtensions.length; i++) {
        currentFileExtension = petaGA_fileExtensions[i];

        if (url.indexOf(currentFileExtension) > 0) {
            return true;
        }
    }
    return false;
}

function lookForLinkedDomain(url) {
    var currentLinkedDomain;
    for (var i = 0; i < petaGA_linkedDomains.length; i++) {
        currentLinkedDomain = petaGA_linkedDomains[i];

        //URL matches linked domain list and is not on the current domain
        if (url.indexOf(currentLinkedDomain) > 0 && url.indexOf(window.location.host) <= 0) {
            return true;
        }
    }
    return false;
}

function gaLinkListener() {
    var currentURL = this.href.toLowerCase();

    //Fire GA events for file download
    if (lookForFileExtension(currentURL)) {
        if (currentURL.indexOf(".pdf") > 0) {
            _gaq.push(['_trackEvent', petaGA_PDFCategory_PDF, petaGA_GenericAction_Download, currentURL]);
        }
        else if (currentURL.indexOf(".png") > 0 || currentURL.indexOf(".jpg") > 0 || currentURL.indexOf(".jpeg") > 0) {
            _gaq.push(['_trackEvent', petaGA_ImageCategory_Image, petaGA_GenericAction_Download, currentURL]);
        }
        else if (currentURL.indexOf(".doc") > 0 || currentURL.indexOf(".docx") > 0) {
            _gaq.push(['_trackEvent', "Word Document", petaGA_GenericAction_Download, currentURL]);
        }
    }
    //Link URL for cross domain tracking
    else if (lookForLinkedDomain(currentURL)) {
        //Timeout is needed for the cross domain linking to work.
        //setTimeout(function() {_gaq.push(['_link', currentURL]);}, 500);
        var pageTracker = _gat._getTrackerByName();
        this.href = pageTracker._getLinkerUrl(this.href);
    }

    return false;
}

function addLinkEventListeners() {
    var allLinks = document.links;
    var currentURL;
    var fileExtensionFound = false;
    var linkedDomainFound = false;
    var linkAddListener;
    var originalOnclick;

    for (var i = 0; i < allLinks.length; i++) {
        currentURL = allLinks[i].href.toString().toLowerCase();
        fileExtensionFound = lookForFileExtension(currentURL);
        linkedDomainFound = lookForLinkedDomain(currentURL);

        //Link has a file extension to be tracked or needs cross domain tracking
        if (fileExtensionFound == true || linkedDomainFound == true) {
            linkAddListener = allLinks[i];

            if (linkAddListener.onclick) {
                //Store any existing onclick event
                originalOnclick = linkAddListener.onclick;
                //Add listener
                linkAddListener.addEventListener("click", gaLinkListener, false);
                if (linkAddListener.addEventListener) {
                    linkAddListener.addEventListener("click", originalOnclick, false);
                }
                else if (linkAddListener.attachEvent) {
                    linkAddListener.attachEvent("click", originalOnclick, false);
                }
            }
            else {
                linkAddListener.addEventListener("click", gaLinkListener, false);
            }
        }
    }
}

function isUniversalAnalytics() {
    if (window.ga) {
        return true;
    }
    else {
        return false;
    }
}

function sendSocialEvent(socialNetwork, socialAction, socialTarget) {
    if (isUniversalAnalytics()) {
        ga('send', 'social', socialNetwork, socialAction, socialTarget);
    }
    else {
        //_gaq.push(['_trackSocial', socialNetwork, socialAction]);
    }
}

function sendEvent(category, action, label, interactive) {
    
    var isInteractive = true;

    if (interactive == null) {
      // All form initiated events should be classified as non-interaction
      if ( action.toLowerCase() == "form initiated" || action.toLowerCase() == "form initiation" ) {
        isInteractive = false;
      } else if ( category.toLowerCase() == "splash page" && (action.toLowerCase() == "viewed" || action.toLowerCase() == "closed") ) {
        isInteractive = false;
      }
    } else {
      isInteractive = interactive;
    }

	
    if (isUniversalAnalytics()) {
    
        if(isInteractive == true){
			ga('send', 'event', category, action, label);
		}
		else{
			ga('send', 'event', category, action, label, {nonInteraction: true});	
		}
    }
    else {
        //_gaq.push(['_trackEvent', category, action, label]);
    }
}

function sendEventWithTracker(category, action, label, trackerName){
	var isNonInteraction = false;

	// All form initiated events should be classified as non-interaction
	if(action.toLowerCase() == "form initiated" || action.toLowerCase() == "form initiation"){
		isNonInteraction = true;
    }
    else if(category.toLowerCase() == "splash page" && (action.toLowerCase() == "viewed" || action.toLowerCase() == "closed")){
        isNonInteraction = true;
    }
	
	if(isNonInteraction == false){
		ga(trackerName + '.send', 'event', category, action, label);
	}
	else{
		ga(trackerName + '.send', 'event', category, action, label, {nonInteraction: true});	
	}
}

function sendEventWithValue(category, action, label, value) {
    if (isUniversalAnalytics()) {
        ga('send', 'event', category, action, label, value);
    }
    else {
        //_gaq.push(['_trackEvent', category, action, label, value]);
    }
}

function sendPageView(trackingURL) {
	if(trackingURL === undefined){
		if (isUniversalAnalytics()) {
			ga('send', 'pageview');
		}
		else {
			//_gaq.push(['_trackPageview']);
		}
	}
	else{
		if (isUniversalAnalytics()) {
			ga('send', 'pageview', trackingURL);
		}
		else {
			//_gaq.push(['_trackPageview', trackingURL]);
		}
	}
}

var petaPIIURL = (function() {
    var originalURL, redactedURL, piiRegex, maybeLoadRedactedURL, loadRedactedURL;
    originalURL = window.location.href;
    piiRegex = [{
        name: 'EMAIL',
        regex: /[^\/=]*(@|(%40))[^\/&]*/gi,
        group: ''
    }, {
        name: 'TEL',
        regex: /((tel=)|(telephone=)|(phone=)|(strPhone=)|(mobile=)|(mob=))[\d\+\s][^&\/\?]+/gi,
        group: '$1'
    }, {
        name: 'NAME',
        regex: /((firstname=)|(fname=)|(strFName=)|(lastname=)|(lname=)|(strLName=)|(surname=))[^&\/\?]+/gi,
        group: '$1'
    }, {
        name: 'PASSWORD',
        regex: /((password=)|(passwd=)|(pass=))[^&\/\?]+/gi,
        group: '$1'
    }, {
        name: 'CITY',
        regex: /(strCity=)[^&\/\?]+/gi,
        group: '$1'
    }, {
        name: 'COUNTRY',
        regex: /(strCountry=)[^&\/\?]+/gi,
        group: '$1'
    }, {
        name: 'ZIP',
        regex: /((postcode=)|(zipcode=)|(zip=)|(strZip=))[^&\/\?]+/gi,
        group: '$1'
    }];
    maybeLoadRedactedURL = function() {
        if ('undefined' === typeof(redactedURL)) {
            loadRedactedURL();
        } else {}
    };
    loadRedactedURL = function() {
        var newURL = decodeURI(originalURL);
        piiRegex.forEach(function(pii) {
            newURL = newURL.replace(pii.regex, pii.group + '[REDACTED ' + pii.name + ']');
        });
        redactedURL = encodeURI(newURL);
    };
    return {
        getPIIRedactedURL: function() {
            maybeLoadRedactedURL();
            return redactedURL;
        },
        containsPII: function() {
            maybeLoadRedactedURL();
            if (redactedURL.includes('REDACTED')) {
                return true;
            } else {
                return false;
            }
        }
    };
})();
////////////////////////////
// GA Translation Events
////////////////////////////


(function() {
// Observe DOM mutations whether the <html> node was changed by Google Translate
if (window.MutationObserver) {
  var mutationObserver = new MutationObserver(function(mutations) {
    mutations.forEach(function (mutation) {
      var oldElementClass =  mutation.oldValue||"";
      var currentElementClass = mutation.target.className;
      if (oldElementClass.indexOf('translated-') === -1 && currentElementClass.indexOf('translated-') > -1) {
        console.log(mutation);
        sendEvent( 'Page Translation', mutation.target.lang || document.getElementsByTagName('html')[0].getAttribute('xml:lang'), 'On-Page Google Translate' );
      }
  })
})
  var htmlNode = document.querySelector('html');
  mutationObserver.observe(htmlNode, {
    attributes: true,
    attributeOldValue: true,
    attributeFilter: ['class']
  })
}
// Let's also track pageviews when the page is translated directly from translate.google.com or bing.com/translator
// A function that can return individual query parameter (borrowed from https://davidwalsh.name/query-string-javascript)
function getUrlParameter(name) {
  name = name.replace(/[\[]/, '\\[').replace(/[\]]/, '\\]');
  var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
  var results = regex.exec(location.search);
  return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
};
// Check if the page is being translated directly from translate.google.com (viewed within the iframe)
if (window.location.href.indexOf('translate.googleusercontent.com') > -1 ) {
    sendEvent( 'Page Translation', getUrlParameter('tl'), 'Google Translate Website' );
}
// Check if the page is being translated directly from bing.com/translator (viewed within the iframe)
// these appear to not work but Michael suggsted leaving them for now as Emily wasn't 100% clear that we should take them out - @Don
if (window.location.href.indexOf('translatoruser-int.com') > -1 ) {
    sendEvent( 'Page Translation', getUrlParameter('to'), 'Bing Translator Website' );
}
})();

//This replaces the common function in all gaBAse files
createLegacyGATag = function (){
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
    })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
}
